<html>

<head>
<style>
    body {
        overflow: hidden;
        margin: 8px;
    }

    #container {
        width: calc(100vw - 175px);
        height: 98vh;
        margin: 0;
        padding: 0;
        margin-left: 158px;
    }

    #panel {
        width: 150px;
        height: 98vh;
        position: fixed;
        margin: 0;
        padding: 0;
    }

    #rich, #input-console, #before-input-console {
        width: 100%;
        border: 1px #CCCCCC solid;
        margin: 0;
        padding: 0;
    }

    #rich {
        height: 20%;
    }

    textarea {
        width: 100%;
        margin: 0;
        padding: 0;
        height: 10%;
        margin-top: 1%;
    }

    #input-console, #before-input-console {
        margin-top: 1%;
        height: 32%;
        overflow: scroll;
        background-color: #F6F6F6;
        white-space: nowrap;
    }

    select {
        width: 100%;
        height: 100%;
    }
</style>
<script type="text/javascript">
    var inputEvents = [];
    var lastEvent;

    function inputEventToString(event) {
        var result = `[${(Date.now() / 1000).toFixed(3)}] <${event.target.tagName}>: inputType: "${event.inputType}", data: "${event.data}"`;
        if (event.dataTransfer)
            result += ` dataTransfer: "${event.dataTransfer.getData("text/html")}"`
        else
            result += ` dataTransfer: "${event.dataTransfer}"`
        return result;
    }

    function input(event) {
        let inputConsole = document.querySelector("#input-console");
        let output = document.createElement("code");
        output.textContent = inputEventToString(event);
        let lineBreak = document.createElement("br");
        inputConsole.appendChild(output);
        inputConsole.appendChild(lineBreak);
        inputConsole.scrollTop = 1000000;

        inputEvents.push(event);
        lastEvent = event;
    }

    function beforeInput(event) {
        let beforeInputConsole = document.querySelector("#before-input-console");
        let output = document.createElement("code");
        output.textContent = inputEventToString(event);
        if (preventDefaultIfNecessary(event))
            output.style.color = "#FF6666";

        let lineBreak = document.createElement("br");
        beforeInputConsole.appendChild(output);
        beforeInputConsole.appendChild(lineBreak);
        beforeInputConsole.scrollTop = 1000000;
    }

    function preventDefaultIfNecessary(event) {
        if (document.querySelector("#prevent-everything").selected) {
            event.preventDefault();
            return true;
        }

        if (event.inputType) {
            let option = document.querySelector(`#prevent-${event.inputType}`);
            if (option.selected) {
                event.preventDefault();
                return true;
            }
        }

        return false;
    }

    function keydown(event) {
        if (event.which != 75 || !event.metaKey)
            return;

        document.querySelector("#input-console").innerHTML = "";
        document.querySelector("#before-input-console").innerHTML = "";
    }
</script>
</head>

<body onkeydown=keydown(event)>
<div id="panel">
    <select name="preventDefaultTypes" multiple>
        <option id="prevent-insertText">insertText</option>
        <option id="prevent-insertReplacementText">insertReplacementText</option>
        <option id="prevent-insertLineBreak">insertLineBreak</option>
        <option id="prevent-insertParagraph">insertParagraph</option>
        <option id="prevent-insertOrderedList">insertOrderedList</option>
        <option id="prevent-insertUnorderedList">insertUnorderedList</option>
        <option id="prevent-insertHorizontalRule">insertHorizontalRule</option>
        <option id="prevent-insertFromYank">insertFromYank</option>
        <option id="prevent-insertFromDrop">insertFromDrop</option>
        <option id="prevent-insertFromPaste">insertFromPaste</option>
        <option id="prevent-insertCompositionText">insertCompositionText</option>
        <option id="prevent-insertFromComposition">insertFromComposition</option>
        <option id="prevent-deleteWordForward">deleteWordForward</option>
        <option id="prevent-deleteWordBackward">deleteWordBackward</option>
        <option id="prevent-deleteSoftLineForward">deleteSoftLineForward</option>
        <option id="prevent-deleteSoftLineBackward">deleteSoftLineBackward</option>
        <option id="prevent-deleteEntireSoftLine">deleteEntireSoftLine</option>
        <option id="prevent-deleteHardLineForward">deleteHardLineForward</option>
        <option id="prevent-deleteHardLineBackward">deleteHardLineBackward</option>
        <option id="prevent-deleteCompositionText">deleteCompositionText</option>
        <option id="prevent-deleteByComposition">deleteByComposition</option>
        <option id="prevent-deleteByDrag">deleteByDrag</option>
        <option id="prevent-deleteByCut">deleteByCut</option>
        <option id="prevent-deleteContent">deleteContent</option>
        <option id="prevent-deleteContentBackward">deleteContentBackward</option>
        <option id="prevent-deleteContentForward">deleteContentForward</option>
        <option id="prevent-historyUndo">historyUndo</option>
        <option id="prevent-historyRedo">historyRedo</option>
        <option id="prevent-insertTranspose">insertTranspose</option>
        <option id="prevent-formatBold">formatBold</option>
        <option id="prevent-formatItalic">formatItalic</option>
        <option id="prevent-formatUnderline">formatUnderline</option>
        <option id="prevent-formatForecolor">formatForecolor</option>
        <option id="prevent-formatStrikeThrough">formatStrikeThrough</option>
        <option id="prevent-formatSuperscript">formatSuperscript</option>
        <option id="prevent-formatSubscript">formatSubscript</option>
        <option id="prevent-formatJustifyCenter">formatJustifyCenter</option>
        <option id="prevent-formatJustifyRight">formatJustifyRight</option>
        <option id="prevent-formatJustifyLeft">formatJustifyLeft</option>
        <option id="prevent-formatIndent">formatIndent</option>
        <option id="prevent-formatOutdent">formatOutdent</option>
        <option id="prevent-formatRemove">formatRemove</option>
        <option id="prevent-everything">EVERYTHING!</option>
    </select>
</div>
<div id="container">
    <div id="rich" contenteditable oninput="input(event)" onbeforeinput="beforeInput(event)"></div>
    <textarea id="plain" contenteditable oninput="input(event)" onbeforeinput="beforeInput(event)"></textarea>
    <div id="input-console"></div>
    <div id="before-input-console"></div>
</div>
</body>

</html>
