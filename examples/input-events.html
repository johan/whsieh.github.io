<html>

<head>
<style>
    body {
        overflow: hidden;
        margin: 8px;
    }

    #container {
        width: calc(100vw - 175px);
        height: 98vh;
        margin: 0;
        padding: 0;
        margin-left: 158px;
    }

    #panel {
        width: 150px;
        height: 98vh;
        position: fixed;
        margin: 0;
        padding: 0;
    }

    #rich, #input-console, #before-input-console {
        width: 100%;
        border: 1px #CCCCCC solid;
        margin: 0;
        padding: 0;
    }

    #rich {
        height: 20%;
    }

    textarea {
        width: 100%;
        margin: 0;
        padding: 0;
        height: 10%;
        margin-top: 1%;
    }

    #input-console, #before-input-console {
        margin-top: 1%;
        height: 32%;
        overflow: scroll;
        background-color: #F6F6F6;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
    }

    select {
        width: 100%;
        height: 70%;
    }

    .attribute {
        color: #FF3333;
    }
</style>
<script type="text/javascript">
    var inputEvents = [];
    var lastEvent;

    function targetRangesToStringForEvent(event) {
        if (!event.getTargetRanges)
            return "(null)";

        var targetRangeStrings = [];
        for (let range of event.getTargetRanges())
            targetRangeStrings.push(`(${range.startContainer.nodeName}:${range.startOffset}, ${range.endContainer.nodeName}:${range.endOffset})`);
        return targetRangeStrings.length ? targetRangeStrings.join(", ") : "()";
    }

    function htmlEscapedString(s) {
        let div = document.createElement("div");
        div.textContent = s;
        return div.innerHTML;
    }

    function dataToStringForEvent(event) {
        return event.data ? `"${htmlEscapedString(event.data)}"` : "(null)";
    }

    function dataTransferToStringForEvent(event) {
        if (!event.dataTransfer)
            return "(null)";

        if (event.dataTransfer.items)
            return `(${event.dataTransfer.items.length} items)`

        return `plain="${htmlEscapedString(event.dataTransfer.getData('text/plain'))}", HTML=${htmlEscapedString(event.dataTransfer.getData('text/html'))}`;
    }

    function inputEventToString(event) {
        var result = `[${(Date.now() / 1000).toFixed(3)}] <b>(${event.target.tagName})</b>`;
        if (showInputType.checked)
            result += `  <span class="attribute"><b>inputType</b></span> "${event.inputType}"`;
        if (showData.checked)
            result += `  <span class="attribute"><b>data</b></span> ${dataToStringForEvent(event)}`;
        if (showDataTransfer.checked)
            result += `  <span class="attribute"><b>dataTransfer</b></span> ${dataTransferToStringForEvent(event)}`;
        if (showTargetRanges.checked)
            result += `  <span class="attribute"><b>targetRanges</b></span> ${targetRangesToStringForEvent(event)}`;
        return result;
    }

    function input(event) {
        let inputConsole = document.querySelector("#input-console");
        let output = document.createElement("code");
        output.innerHTML = inputEventToString(event);
        let lineBreak = document.createElement("br");
        inputConsole.appendChild(output);
        inputConsole.appendChild(lineBreak);
        inputConsole.scrollTop = 1000000;

        inputEvents.push(event);
        lastEvent = event;
    }

    function beforeInput(event) {
        let beforeInputConsole = document.querySelector("#before-input-console");
        let output = document.createElement("code");
        output.innerHTML = inputEventToString(event);
        if (preventDefaultIfNecessary(event))
            output.style.color = "#FF6666";
        else if (!event.cancelable)
            output.style.color = "#6666FF";

        let lineBreak = document.createElement("br");
        beforeInputConsole.appendChild(output);
        beforeInputConsole.appendChild(lineBreak);
        beforeInputConsole.scrollTop = 1000000;
    }

    function preventDefaultIfNecessary(event) {
        if (!event.cancelable)
            return false;

        if (document.querySelector("#prevent-everything").selected) {
            event.preventDefault();
            return true;
        }

        if (event.inputType) {
            let option = document.querySelector(`#prevent-${event.inputType}`);
            if (option.selected) {
                event.preventDefault();
                return true;
            }
        }

        return false;
    }

    function keydown(event) {
        if (event.which != 75 || !event.metaKey)
            return;

        document.querySelector("#input-console").innerHTML = "";
        document.querySelector("#before-input-console").innerHTML = "";
    }
</script>
</head>

<body onkeydown=keydown(event)>
<div id="panel">
    <p><code>Prevent default</code></p>
    <select name="preventDefaultTypes" multiple>
        <option id="prevent-insertText">insertText</option>
        <option id="prevent-insertReplacementText">insertReplacementText</option>
        <option id="prevent-insertLineBreak">insertLineBreak</option>
        <option id="prevent-insertParagraph">insertParagraph</option>
        <option id="prevent-insertOrderedList">insertOrderedList</option>
        <option id="prevent-insertUnorderedList">insertUnorderedList</option>
        <option id="prevent-insertHorizontalRule">insertHorizontalRule</option>
        <option id="prevent-insertFromYank">insertFromYank</option>
        <option id="prevent-insertFromDrop">insertFromDrop</option>
        <option id="prevent-insertFromPaste">insertFromPaste</option>
        <option id="prevent-insertFromComposition">insertFromComposition</option>
        <option id="prevent-deleteWordForward">deleteWordForward</option>
        <option id="prevent-deleteWordBackward">deleteWordBackward</option>
        <option id="prevent-deleteSoftLineForward">deleteSoftLineForward</option>
        <option id="prevent-deleteSoftLineBackward">deleteSoftLineBackward</option>
        <option id="prevent-deleteEntireSoftLine">deleteEntireSoftLine</option>
        <option id="prevent-deleteHardLineForward">deleteHardLineForward</option>
        <option id="prevent-deleteHardLineBackward">deleteHardLineBackward</option>
        <option id="prevent-deleteByComposition">deleteByComposition</option>
        <option id="prevent-deleteByDrag">deleteByDrag</option>
        <option id="prevent-deleteByCut">deleteByCut</option>
        <option id="prevent-deleteContent">deleteContent</option>
        <option id="prevent-deleteContentBackward">deleteContentBackward</option>
        <option id="prevent-deleteContentForward">deleteContentForward</option>
        <option id="prevent-historyUndo">historyUndo</option>
        <option id="prevent-historyRedo">historyRedo</option>
        <option id="prevent-insertTranspose">insertTranspose</option>
        <option id="prevent-formatBold">formatBold</option>
        <option id="prevent-formatItalic">formatItalic</option>
        <option id="prevent-formatUnderline">formatUnderline</option>
        <option id="prevent-formatForecolor">formatForecolor</option>
        <option id="prevent-formatStrikeThrough">formatStrikeThrough</option>
        <option id="prevent-formatSuperscript">formatSuperscript</option>
        <option id="prevent-formatSubscript">formatSubscript</option>
        <option id="prevent-formatJustifyCenter">formatJustifyCenter</option>
        <option id="prevent-formatJustifyRight">formatJustifyRight</option>
        <option id="prevent-formatJustifyLeft">formatJustifyLeft</option>
        <option id="prevent-formatIndent">formatIndent</option>
        <option id="prevent-formatOutdent">formatOutdent</option>
        <option id="prevent-formatRemove">formatRemove</option>
        <option id="prevent-everything">EVERYTHING!</option>
    </select>
    <div id="show-options">
        <p><code>Log output options</code></p>
        <div><input type="checkbox" id="showInputType" checked><code> inputType</code></input></div>
        <div><input type="checkbox" id="showTargetRanges" checked><code> getTargetRanges</code></input></div>
        <div><input type="checkbox" id="showData" checked><code> data</code></input></div>
        <div><input type="checkbox" id="showDataTransfer" checked><code> dataTransfer</code></input></div>
    </div>
</div>
<div id="container">
    <div id="rich" contenteditable oninput="input(event)" onbeforeinput="beforeInput(event)"></div>
    <textarea id="plain" contenteditable oninput="input(event)" onbeforeinput="beforeInput(event)"></textarea>
    <div id="before-input-console"></div>
    <div id="input-console"></div>
</div>
</body>

</html>
